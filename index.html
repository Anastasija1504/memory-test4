<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Переверни послідовність — діагностика</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7dd3fc;--accent2:#a78bfa;--glass: rgba(255,255,255,0.04)}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{margin:0;padding:28px;background:#071023;color:#e6eef8}
    .app{max-width:980px;margin:0 auto;background:#081222;padding:18px;border-radius:12px}
    .sequence-box{width:320px;height:120px;border-radius:12px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-size:62px}
    .sequence-box.small-text{font-size:20px !important}
    input[type=text]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#022235}
    .debug{margin-top:10px;color:#9fb7d6;font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <h2>Переверни послідовність — тест</h2>

    <label>Ім'я: <input id="playerName" type="text" placeholder="Ваше ім'я"></label>
    <div style="margin:10px 0">
      <button id="startBtn" class="btn btn-primary" type="button">Почати гру</button>
    </div>

    <div class="sequence-box small-text" id="display">Натисніть «Почати гру»</div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <input id="answer" type="text" placeholder="Введіть відповідь тут" />
      <button id="submitBtn" class="btn btn-primary" type="button">Відправити</button>
    </div>

    <div class="debug" id="debugLog">Debug: (консоль також показує логи)</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', ()=> {
      // Very defensive logging & bindings
      console.clear();
      console.log('DOMContentLoaded fired — binding elements');

      // elements
      const startBtn = document.getElementById('startBtn');
      const submitBtn = document.getElementById('submitBtn');
      const answer = document.getElementById('answer');
      const display = document.getElementById('display');
      const debugLog = document.getElementById('debugLog');

      function dbg(msg){ 
        console.log(msg);
        if(debugLog) debugLog.textContent = 'Debug: ' + msg;
      }

      if(!startBtn) { dbg('MISSING startBtn'); return; }
      if(!submitBtn) { dbg('MISSING submitBtn'); return; }
      if(!answer) { dbg('MISSING answer input'); return; }
      if(!display) { dbg('MISSING display'); return; }

      dbg('All required elements found — attaching handlers');

      // simple state for demonstration
      let accepting = false;
      let currentSeq = [9,8,4];

      // start button
      startBtn.addEventListener('click', ()=>{
        dbg('Start pressed — showing sequence (simulated)');
        // show sequence digits one by one (quick simulation)
        accepting = false;
        display.classList.remove('small-text');
        display.textContent = '';
        let i=0;
        const showOne = ()=> {
          if(i < currentSeq.length){
            display.textContent = currentSeq[i];
            i++;
            setTimeout(()=> {
              display.textContent = '';
              setTimeout(showOne, 220);
            }, 700);
          } else {
            display.classList.add('small-text');
            display.textContent = 'Тепер введіть відповідь';
            accepting = true;
            answer.focus();
            dbg('Sequence done — now accepting answers');
          }
        }
        showOne();
      });

      // primary click handler for submitBtn
      submitBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        dbg('submitBtn click handler invoked');
        attemptSubmit();
      });

      // delegation fallback: capture clicks anywhere and if target has id submitBtn, call handler
      document.addEventListener('click', (e)=>{
        if(e.target && (e.target.id === 'submitBtn' || e.target.closest && e.target.closest('#submitBtn'))){
          dbg('document click delegation caught submitBtn click');
          // small delay to avoid double-run (if real button also fired)
          setTimeout(()=> attemptSubmit(), 0);
        }
      });

      // Enter key handling on answer input
      answer.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){
          e.preventDefault();
          dbg('Enter pressed in answer field (keydown)');
          attemptSubmit();
        }
      });

      // also support global Enter as fallback
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' && document.activeElement === answer){
          // already handled above, but keep as safety
          dbg('Global keydown Enter (fallback)');
          attemptSubmit();
        }
      });

      function attemptSubmit(){
        dbg('attemptSubmit called — accepting=' + accepting);
        if(!accepting){
          dbg('Not accepting answers right now. Click ignored.');
          return;
        }
        const raw = (answer.value || '').trim();
        if(!raw){
          dbg('Empty answer — alerting');
          alert('Введіть відповідь (наприклад 123)');
          answer.focus();
          return;
        }
        const expected = currentSeq.slice().reverse().join('');
        const ok = raw === expected;
        dbg('User answer: ' + raw + ' expected: ' + expected + ' ok=' + ok);
        if(ok) {
          display.classList.remove('small-text');
          display.textContent = 'Правильно!';
        } else {
          display.classList.remove('small-text');
          display.textContent = 'Неправильно — правильна: ' + expected;
        }
        accepting = false;
        setTimeout(()=> {
          display.classList.add('small-text');
          display.textContent = 'Натисніть «Почати гру»';
        }, 1000);
      }

      dbg('Handlers attached. Ready.');
    });
  </script>
</body>
</html>
